inputs:
  nuget-feed-source:
    required: false
    type: string
  nuget-feed-name:
    required: false
    type: string
  azure-devops-token:
    required: true
    type: string
  

runs:
  using: "composite"
  steps:
   # checkout
    - uses: actions/checkout@v3
  
    # build api
    - uses: ./.github/actions/build/dotnet/jobs/aspnet-core
      with:
        apply-versioning: true
        projects: src/Blab.Api/src/Blab.Api/Blab.Api.csproj
        nuget-feed-source: ${{ inputs.nuget-feed-source }}
        nuget-feed-name: ${{ inputs.nuget-feed-name }}
        azure-devops-token: ${{ inputs.azure-devops-token }}
        # tests: '' # Run all csproj which match the pattern **/*.Tests.csproj
        # should-run-tests: true # TODO: Uncomment when deploying working

    # build identity
    - uses: ./.github/actions/build/dotnet/jobs/aspnet-core
      with:
        apply-versioning: true
        projects: src/Blab.Api/src/Blab.Identity/Blab.Identity.csproj
        nuget-feed-source: ${{ inputs.nuget-feed-source }}
        nuget-feed-name: ${{ inputs.nuget-feed-name }}
        azure-devops-token: ${{ inputs.azure-devops-token }}
        # tests: '' # Run all csproj which match the pattern **/*.Tests.csproj
        # should-run-tests: true # TODO: Uncomment when deploying working

    # build vue app
    - uses: ./.github/actions/build/npm/jobs/npm-application
      with:
        apply-versioning: true
        projects: src/Blab.Ui
        # tests: '' # Run all csproj which match the pattern **/*.Tests.csproj
        # should-run-tests: true # TODO: Uncomment when deploying working