inputs:
  nuget-feed-source:
    required: false
    type: string
  nuget-feed-name:
    required: false
    type: string
  azure-devops-token:
    required: true
    type: string
  dotnet-version:
    required: false
    type: string
    default: '6.x'
  node-version:
    required: false
    type: string
    default: 'latest'
  

runs:
  using: "composite"
  steps:
    # checkout
    - uses: actions/checkout@v3

    # # create dotnet environment for api/ identity
    # - uses: ./.github/actions/build/common/environment/tasks/setup-dotnet-environment
    #   with:
    #     dotnet-version: ${{ inputs.dotnet-version }}
    # - run: echo "pat token ${{ inputs.azure-devops-token }}"
    #   shell: bash
    # - name: Auth NuGet
    #   if: ${{ inputs.nuget-feed-name }} != '' 
    #   shell: bash
    #   run: dotnet nuget add source ${{ inputs.nuget-feed-source }} --name ${{ inputs.nuget-feed-name }} --username az --password ${{ inputs.azure-devops-token }} --store-password-in-clear-text

    # # build api
    # - uses: ./.github/actions/build/dotnet/jobs/aspnet-core
    #   with:
    #     artifact-name: 'blab.api'
    #     apply-versioning: true
    #     projects: src/Blab.Api/src/Blab.Api/Blab.Api.csproj
    #     nuget-feed-source: ${{ inputs.nuget-feed-source }}
    #     nuget-feed-name: ${{ inputs.nuget-feed-name }}
    #     azure-devops-token: ${{ inputs.azure-devops-token }}
    #     # tests: '' # Run all csproj which match the pattern **/*.Tests.csproj
    #     # should-run-tests: true # TODO: Uncomment when deploying working

    # # build identity
    # - uses: ./.github/actions/build/dotnet/jobs/aspnet-core
    #   with:
    #     artifact-name: 'blab.identity'
    #     apply-versioning: true
    #     projects: src/Blab.Api/src/Blab.Identity/Blab.Identity.csproj
    #     nuget-feed-source: ${{ inputs.nuget-feed-source }}
    #     nuget-feed-name: ${{ inputs.nuget-feed-name }}
    #     azure-devops-token: ${{ inputs.azure-devops-token }}
    #     # tests: '' # Run all csproj which match the pattern **/*.Tests.csproj
    #     # should-run-tests: true # TODO: Uncomment when deploying working

    # create node environment for spa
    - uses: ./.github/actions/build/common/environment/tasks/setup-node-environment
      with:
        node-version: ${{ inputs.node-version }}

    # build vue app
    - uses: ./.github/actions/build/npm/jobs/npm-application
      with:
        apply-versioning: true
        path: src/blab.ui
        artifact-name: blab.ui
        # tests: '' # Run all csproj which match the pattern **/*.Tests.csproj
        # should-run-tests: true # TODO: Uncomment when deploying working