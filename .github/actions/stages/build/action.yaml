inputs:
  azure-devops-token:
    required: true
    type: string

runs:
  using: "composite"
  steps:
   # checkout
    - uses: actions/checkout@v3
    - name: Auth NuGet
      shell: bash
      run: dotnet nuget add source ${{ env.NUGET_FEED_SOURCE }} --name ${{ env.NUGET_FEED_NAME }} --username az --password ${{ inputs.azure-devops-token }}
  
    # build api
    - uses: ./.github/actions/build/dotnet/jobs/aspnet-core
      with:
        apply-versioning: true
        projects: src/Blab.Api/src/Blab.Api/Blab.Api.csproj
        # tests: '' # Run all csproj which match the pattern **/*.Tests.csproj
        # should-run-tests: true # TODO: Uncomment when deploying working
    # build identity
    - uses: ./.github/actions/build/dotnet/jobs/aspnet-core
      with:
        apply-versioning: true
        projects: src/Blab.Api/src/Blab.Identity/Blab.Identity.csproj
        # tests: '' # Run all csproj which match the pattern **/*.Tests.csproj
        # should-run-tests: true # TODO: Uncomment when deploying working
    # build vue app
    - uses: ./.github/actions/build/npm/jobs/npm-application
      with:
        apply-versioning: true
        projects: src/Blab.Ui
        # tests: '' # Run all csproj which match the pattern **/*.Tests.csproj
        # should-run-tests: true # TODO: Uncomment when deploying working